## Рассматриваемый пример

```
Функция ПолучитьСтоимость(ВходныеПараметры) Экспорт
	Стоимость = 0;
	Если ВходныеПараметры.ФормироватьПоЗапасам Тогда
		Выборка = ВыполнитьЗапросПолученияСтоимостиПоЗапасам.Выбрать();
				
		ВалютаУчета = УОП_ОбщегоНазначения.ЗначениеКонстанты("ВалютаУчета");
		Если НЕ ЗначениеЗаполнено(ВходныеПараметры.Валюта) Тогда
			ВходныеПараметры.Валюта = ВалютаУчета;
		КонецЕсли; 
		
		Если Выборка.Следующий() Тогда
			
			Если ЗначениеЗаполнено(Выборка.Количество) Тогда
				Если ВходныеПараметры.ЗначениеОтображатьСебестоимостьСНДС Тогда
					Если ВалютаУчета = ВходныеПараметры.Валюта Тогда
						Стоимость = Выборка.Сумма/Выборка.Количество;
					Иначе
						Стоимость = РаботаСКурсамиВалют.ПересчитатьВВалюту(Выборка.Сумма/Выборка.Количество, ВалютаУчета, 
							ВходныеПараметры.Валюта, ВходныеПараметры.Дата);
					КонецЕсли;	
				Иначе
					Если ВалютаУчета = ВходныеПараметрыВалюта Тогда
						Стоимость = (Выборка.Сумма - Выборка.СуммаНДС)/Выборка.Количество;
					Иначе
						Стоимость = РаботаСКурсамиВафлют.ПересчитатьВВалюту((Выборка.Сумма - Выборка.СуммаНДС)/Выборка.Количество, 
						ВалютаУчета, ВходныеПараметры.Валюта, ВходныеПараметры.Дата);
					КонецЕсли;	
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;

	Если Стоимость = 0 Тогда
		СтруктураДанные = ПодготовитьСтруктуруДляРасчетаЦен(ВходныеПараметры);

		Стоимость = ЦенообразованиеСервер.ПолучитьЦенуНоменклатурыПоВидуЦен(СтруктураДанные);		
	КонецЕсли;
	
	Возврат Стоимость;
КонецФункции

```
